<!doctype html>
<html lang="en-US" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Comprehensive Explanation of Distributed Transaction Seata and Its Three Modes | Apache Seata</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://seata.apache.org/img/seata_logo.png"><meta data-rh="true" name="twitter:image" content="https://seata.apache.org/img/seata_logo.png"><meta data-rh="true" property="og:url" content="https://seata.apache.org/blog/seata-at-tcc-saga"><meta data-rh="true" property="og:locale" content="en_US"><meta data-rh="true" property="og:locale:alternate" content="zh_CN"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Comprehensive Explanation of Distributed Transaction Seata and Its Three Modes | Apache Seata"><meta data-rh="true" name="description" content="This article focuses on sharing the background and theoretical foundation of distributed transactions, as well as the principles of Seata distributed transactions and the implementation of three modes (AT, TCC, Saga) of distributed transactions."><meta data-rh="true" property="og:description" content="This article focuses on sharing the background and theoretical foundation of distributed transactions, as well as the principles of Seata distributed transactions and the implementation of three modes (AT, TCC, Saga) of distributed transactions."><meta data-rh="true" name="keywords" content="Saga,Seata,AT,TCC,consistency,finance,distributed,transaction"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2019-08-11T00:00:00.000Z"><link data-rh="true" rel="icon" href="/img/seata_logo_small.jpeg"><link data-rh="true" rel="canonical" href="https://seata.apache.org/blog/seata-at-tcc-saga"><link data-rh="true" rel="alternate" href="https://seata.apache.org/blog/seata-at-tcc-saga" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://seata.apache.org/zh-cn/blog/seata-at-tcc-saga" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://seata.apache.org/blog/seata-at-tcc-saga" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ICHFIJRDZF-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Seata RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Seata Atom Feed">


<link rel="search" type="application/opensearchdescription+xml" title="Apache Seata" href="/opensearch.xml">


<meta name="aes-config" content="pid=xux-opensource&amp;user_type=101&amp;uid=&amp;username=&amp;dim10=seata"><link rel="stylesheet" href="/assets/css/styles.9644caf2.css">
<script src="/assets/js/runtime~main.bf98ee01.js" defer="defer"></script>
<script src="/assets/js/main.88c554fd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/seata_logo.png" alt="Seata Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/seata_logo.png" alt="Seata Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/">Home</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" docid="/overview/what-is-seata" href="/docs/overview/what-is-seata">v2.2</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/overview/what-is-seata">Next Version</a></li><li><a class="dropdown__link" href="/docs/overview/what-is-seata">v2.2</a></li><li><a class="dropdown__link" href="/docs/v2.1/overview/what-is-seata">v2.1</a></li><li><a class="dropdown__link" href="/docs/v2.0/overview/what-is-seata">v2.0</a></li><li><a class="dropdown__link" href="/docs/v1.8/overview/what-is-seata">v1.8</a></li><li><a class="dropdown__link" href="/docs/v1.7/overview/what-is-seata">v1.7</a></li><li><a class="dropdown__link" href="/docs/v1.6/overview/what-is-seata">v1.6</a></li><li><a class="dropdown__link" href="/docs/v1.5/overview/what-is-seata">v1.5</a></li><li><a class="dropdown__link" href="/docs/v1.4/overview/what-is-seata">v1.4</a></li><li><a class="dropdown__link" href="/docs/v1.3/overview/what-is-seata">v1.3</a></li><li><a class="dropdown__link" href="/docs/v1.2/overview/what-is-seata">v1.2</a></li><li><a class="dropdown__link" href="/docs/v1.1/overview/what-is-seata">v1.1</a></li><li><a class="dropdown__link" href="/docs/v1.0/overview/what-is-seata">v1.0</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/developers/contributor-guide/new-contributor-guide_dev">Developers</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/users">Users</a><a class="navbar__item navbar__link" href="/community">Community</a><a class="navbar__item navbar__link" href="/unversioned/download/seata-server">Download</a><a class="navbar__item navbar__link" href="/solution">Solution</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Designer</a><ul class="dropdown__menu"><li><a href="/saga-designer" class="dropdown__link" target="_blank">Saga Designer</a></li><li><a href="/saga-designer-legacy" class="dropdown__link" target="_blank">Saga Designer (Legacy)</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_DSK9"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>En</a><ul class="dropdown__menu"><li><a href="/blog/seata-at-tcc-saga" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-US">En</a></li><li><a href="/zh-cn/blog/seata-at-tcc-saga" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-CN">ä¸­</a></li></ul></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All Posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-namingserver">seata-namingserver</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-raft-config-center">Seata Raft Configuration Center</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-rpc-multi-protocol01">Seata&#x27;s RPC Communication Source Code Analysis 01(Transport)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-rpc-multi-protocol02">Seata&#x27;s RPC Communication Source Code Analysis 02(Multi-Version Protocols)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/how-to-write-unit-tests">How to Write Test Cases in Seata</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/explore-seata-journey">Exploring the Journey of Open Source Development in Seata Project</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-raft-detailed-explanation">Seata-Raft Storage Mode in Depth and Getting Started</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-connect-data-and-application">Seata:Bridging Data and Applications</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-observable-practice">Observability Practices in Seata</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-go-1.2.0">seata-go 1.2.0 Ready for Production Environment!!!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/iscas2023">6 Major Topics Now Open for Selection | Welcome to Apply for Seata Open Source Summer</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-1.6.0">Seata 1.6.0 Released with Significant Performance Improvement</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-1.5.2">Seata 1.5.2 Released with XID Load Balancing Support</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-tcc-fence">Alibaba Seata Resolves Idempotence, Dangling, and Empty Rollback Issues in TCC Mode</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-tcc">In-Depth Analysis of Seata TCC Mode (1)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-at-lock">In-Depth Analysis of Seata AT Mode Transaction Isolation Levels and Global Lock Design</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-snowflake-explain">Q&amp;A on the New Version of Snowflake Algorithm</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-UUID-generator">Analysis of Seata&#x27;s Distributed UUID Generator Based on Improved Snowflake Algorithm</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-feature-undo-log-compress">Seata New Feature Support -- Undo_Log Compression</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-dsproxy-deadlock">Seata Deadlock Issue Caused by ConcurrentHashMap</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-client-start-analysis-02">Seata Application-Side Startup Process Analysis â Registry and Configuration Module</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-client-start-analysis-01">Analysis of Seata Application-Side Startup Process - How RM &amp; TM Establish Connections with TC</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/integrate-seata-tcc-mode-with-spring-cloud">Integration of Spring Cloud with Seata for Distributed Transaction - TCC Mode</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-config-manager">Analysis of Seata Configuration Management Principles</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-golang-communication-mode">Detailed Explanation of seata-golang Communication Model</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-datasource-proxy">Analysis of Seata Data Source Proxy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-sourcecode-client-bootstrap">Seata Source Code - Client Startup Process in Distributed Transactions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-at-demo-in-mac">Setting Up Seata Demo Environment on Mac (AT Mode)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-rpc-refactor">The Refactoring Journey of Seata RPC Module</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-sourcecode-server-bootstrap">Seata Source Code - Server Startup Process in Distributed Transactions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-xa-introduce">How is distributed transaction realized? In-depth interpretation of Seata&#x27;s XA mode</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-quick-start">Seata Quick Start</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-ha-practice">Seata High Availability Deployment Practice</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-config-modular">Seata Config Module Source Code Analysis</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-dubbo-transmit-xid">Source Code Analysis of Seata-XID Propagation in Dubbo</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-tcc-modular">Seata TCC Module Source Code Analysis</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-community-meetup-hangzhou-ready">Seata Community MeetupÂ·Hangzhou Station</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-core-modular">Seata Core Module Source Code Analysis</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-spring-boot-aop-aspectj">Dynamically Creating/Closing Seata Distributed Transactions through AOP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-dynamic-config-and-dynamic-disable">Seata Dynamic Configuration Subscription and Degradation Implementation Principles</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-config-center">Seata Configuration Center Implementation Principles</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-nacos-docker">Docker Deployment of Seata Integration with Nacos</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-nacos-analysis">Configuring Seata Distributed Transaction with Nacos as the Configuration Center</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-meetup-hangzhou">Seata Community MeetupÂ·Hangzhou Station</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-mybatisplus-analysis">Resolving the Issue of Losing Mybatis-Plus Features in Seata AT Mode Integration through Source Code</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/springboot-dubbo-mybatisplus-seata">Integrating Seata Distributed Transaction with SpringBoot+Dubbo+MybatisPlus</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-at-mode-start-rm-tm">Does Seata Client Need to Start RM and TM Simultaneously?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-at-mode-start">Seata AT Mode Startup Source Code Analysis</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/design-more-flexable-application-by-saga">Designing More Flexible Financial Applications with Seata Saga</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/seata-at-tcc-saga">Comprehensive Explanation of Distributed Transaction Seata and Its Three Modes</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-at-mode-design">Design Principles of Distributed Transaction Middleware Seata</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-go-server">Seata Distributed Go Server Officially Open Source - Introduction to TaaS Design</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/how-to-support-spring-cloud">Fescar Integration with Spring Cloud In-Depth Analysis of Source Code</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/integrate-seata-with-spring-cloud">Integrating Seata (formerly Fescar) Distributed Transaction with Spring Cloud</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-java-client">Detailed Explanation of Seata-Client Principles and Processes in Distributed Transactions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-java-server">In-Depth Analysis of One-Stop Distributed Transaction Solution Seata-Server</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tcc-mode-applicable-scenario-analysis">Analysis of Applicable Models and Scenarios for TCC</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tcc-mode-design-principle">Introduction to TCC Theory and Design Implementation Guide</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/quick-start-use-seata-and-dubbo-services">How to use Seata to ensure consistency between Dubbo Microservices</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/seata-analysis-simple">Unveiling the Principles of Fescar Distributed Transaction</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/manual-transaction-mode">MT mode</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="This article focuses on sharing the background and theoretical foundation of distributed transactions, as well as the principles of Seata distributed transactions and the implementation of three modes (AT, TCC, Saga) of distributed transactions."><meta itemprop="keywords" content="Saga,Seata,AT,TCC,consistency,finance,distributed,transaction"><header><h1 class="title_f1Hy" itemprop="headline">Comprehensive Explanation of Distributed Transaction Seata and Its Three Modes</h1><div class="container_mt6G margin-vert--md"><time datetime="2019-08-11T00:00:00.000Z" itemprop="datePublished">August 11, 2019</time> Â· <!-- -->19 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">long187</span></div></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>Author: Yi Yuan (Chen Long), Ant Gold Services distributed transaction framework core development.
<br>This article is based on the topic of &quot;Distributed Transaction Seata and its Three Patterns&quot; shared at SOFA Meetup#3 on 11 August in Guangzhou, focusing on the background and theoretical foundation of distributed transaction, as well as the principle of Seata distributed transaction and the implementation of distributed transaction in three patterns (AT, TCC, and Saga).</p>
<p>The video and PPT are at the end of this article.</p>
<p><img decoding="async" loading="lazy" alt="3 Distributed Transaction Seata Three Modes Explained-Eiyuan.jpg" src="/assets/images/1-59eeb2c64e493e827495e0417125db43.jpeg" width="746" height="420" class="img_ev3q"></p>
<a name="Ad95d"></a>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="i-background-of-the-emergence-of-distributed-transactions">I. Background of the emergence of distributed transactions<a href="#i-background-of-the-emergence-of-distributed-transactions" class="hash-link" aria-label="Direct link to I. Background of the emergence of distributed transactions" title="Direct link to I. Background of the emergence of distributed transactions">â</a></h2>
<a name="Q2ayF"></a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-distributed-architecture-evolution---horizontal-splitting-of-database">1.1 Distributed Architecture Evolution - Horizontal Splitting of Database<a href="#11-distributed-architecture-evolution---horizontal-splitting-of-database" class="hash-link" aria-label="Direct link to 1.1 Distributed Architecture Evolution - Horizontal Splitting of Database" title="Direct link to 1.1 Distributed Architecture Evolution - Horizontal Splitting of Database">â</a></h3>
<p>AntGold&#x27;s business database was initially a single database with a single table, but with the rapid development of the business data scale, the data volume is getting bigger and bigger, and the single database with a single table is gradually becoming a bottleneck. So we split the database horizontally, splitting the original single database and single table into database slices.</p>
<p>As shown in the figure below, after splitting the database and table, the original write operation that can be completed on a database may be across multiple databases, which gives rise to cross-database transaction problems.</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="/assets/images/2-e3a8a7b0f1e093d70faf16a548dd6742.png" width="325" height="214" class="img_ev3q"></p>
<a name="WBQbC"></a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-distributed-architecture-evolution---business-service-splitting">1.2 Distributed Architecture Evolution - Business Service Splitting<a href="#12-distributed-architecture-evolution---business-service-splitting" class="hash-link" aria-label="Direct link to 1.2 Distributed Architecture Evolution - Business Service Splitting" title="Direct link to 1.2 Distributed Architecture Evolution - Business Service Splitting">â</a></h3>
<p>In the early stage of business development, the single business system architecture of &quot;one piece of cake&quot; can meet the basic business needs. However, with the rapid development of the business, the system&#x27;s access and business complexity are growing rapidly, single-system architecture has gradually become the bottleneck of business development, to solve the problem of high coupling and scalability of the business system demand is becoming stronger and stronger.</p>
<p>As shown in the figure below, Ant Financial Services splits the single business system into multiple business systems in accordance with the design principles of Service Oriented Architecture (SOA), which reduces the coupling between the systems and enables different business systems to focus on their own business, which is more conducive to the development of the business and the scaling of the system capacity.</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="/assets/images/3-548d85e1cdfbab71650a542d5de5d10a.png" width="557" height="277" class="img_ev3q"></p>
<p>After the business system is split according to services, a complete business often needs to call multiple services, how to ensure data consistency between multiple services becomes a difficult problem.</p>
<a name="3oIxE"></a>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ii-theoretical-foundation-of-distributed-transaction">II. Theoretical foundation of distributed transaction<a href="#ii-theoretical-foundation-of-distributed-transaction" class="hash-link" aria-label="Direct link to II. Theoretical foundation of distributed transaction" title="Direct link to II. Theoretical foundation of distributed transaction">â</a></h2>
<a name="akRiW"></a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-two-stage-commit-protocols">2.1 Two-stage commit protocols<a href="#21-two-stage-commit-protocols" class="hash-link" aria-label="Direct link to 2.1 Two-stage commit protocols" title="Direct link to 2.1 Two-stage commit protocols">â</a></h3>
<p><img decoding="async" loading="lazy" alt="16_16_18__08_13_2019.jpg" src="/assets/images/4-5933efe8b07271b941670f74b7322a1f.jpeg" width="746" height="419" class="img_ev3q"></p>
<p>Two phase commit protocol: transaction manager coordinates resource manager in two phases, the first phase prepares resources, that is, reserve the resources needed for the transaction, if every resource manager resource reservation succeeds, the second phase resource commit is performed, otherwise the coordinated resource manager rolls back the resources.</p>
<a name="8tfKI"></a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-tcc">2.2 TCC<a href="#22-tcc" class="hash-link" aria-label="Direct link to 2.2 TCC" title="Direct link to 2.2 TCC">â</a></h3>
<p><img decoding="async" loading="lazy" alt="16_16_51__08_13_2019.jpg" src="/assets/images/5-79c36a571b40ceb0119e48100150675b.jpeg" width="746" height="416" class="img_ev3q"></p>
<p>TCC (Try-Confirm-Cancel) is actually a two-phase commit protocol for servitisation, business developers need to implement these three service interfaces, the first phase of the service is choreographed by the business code to call the Try interface for resource reservation, the Try interface for all participants is successful, the transaction manager will commit the transaction and call the Confirm interface for each participant The transaction manager will commit the transaction and call the Confirm interface of each participant to actually commit the business operation, otherwise the Cancel interface of each participant will be called to rollback the transaction.</p>
<a name="IXxpF"></a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-saga">2.3 Saga<a href="#23-saga" class="hash-link" aria-label="Direct link to 2.3 Saga" title="Direct link to 2.3 Saga">â</a></h3>
<p><img decoding="async" loading="lazy" alt="3 Distributed Transactions Seata Three Patterns Explained - Yi Yuan-9.jpg" src="/assets/images/6-9d33493d97af453a8450f0739fa60a0f.jpeg" width="746" height="420" class="img_ev3q"></p>
<p>Saga is a compensation protocol. In Saga mode, there are multiple participants within a distributed transaction, and each participant is an offsetting compensation service that requires the user to implement its forward and reverse rollback operations according to the business scenario.</p>
<p>During the execution of a distributed transaction, the forward operations of each participant are executed sequentially, and if all forward operations are executed successfully, the distributed transaction commits. If any of the forward operations fails, the distributed transaction backs out and performs a reverse rollback on the previous participants, rolling back the committed participants and returning the distributed transaction to its initial state.</p>
<p>Saga theory is from the paper Sagas published by Hector &amp; Kenneth in 1987.<br>
<br>Saga Positive Service and Compensation Service also need to be implemented by business developers.</p>
<a name="fZPaN"></a>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="iii-seata-and-its-three-patterns-explained-in-detail">III. Seata and its three patterns explained in detail<a href="#iii-seata-and-its-three-patterns-explained-in-detail" class="hash-link" aria-label="Direct link to III. Seata and its three patterns explained in detail" title="Direct link to III. Seata and its three patterns explained in detail">â</a></h2>
<a name="IgVM7"></a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-distributed-transaction-seata-introduction">3.1 Distributed transaction Seata introduction<a href="#31-distributed-transaction-seata-introduction" class="hash-link" aria-label="Direct link to 3.1 Distributed transaction Seata introduction" title="Direct link to 3.1 Distributed transaction Seata introduction">â</a></h3>
<p>Seata (Simple Extensible Autonomous Transaction Architecture) is a distributed transaction solution jointly open-sourced by Ant Financial Services and Alibaba in January 2019.Seata has been open-sourced for about half a year, and currently has more than 11,000 stars. Seata has been open source for about half a year, and now has more than 11,000 stars and a very active community. We warmly welcome you to participate in the Seata community construction, together will Seata become the open source distributed transaction benchmark product.</p>
<p>Seata: <a href="https://github.com/apache/incubator-seata" target="_blank" rel="noopener noreferrer">https://</a>[github.com/apache/incubator-seata](<a href="https://github.com/apache/incubator" target="_blank" rel="noopener noreferrer">https://github.com/apache/incubator</a> -seata)<br>
<br><img decoding="async" loading="lazy" alt="image.png" src="/assets/images/7-409b712dba10afe30f485ec206d0240f.png" width="584" height="142" class="img_ev3q"></p>
<a name="zyy0l"></a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-distributed-transactions-seata-product-module">3.2 Distributed Transactions Seata Product Module<a href="#32-distributed-transactions-seata-product-module" class="hash-link" aria-label="Direct link to 3.2 Distributed Transactions Seata Product Module" title="Direct link to 3.2 Distributed Transactions Seata Product Module">â</a></h3>
<p>As shown in the figure below, there are three major modules in Seata, namely TM, RM and TC. TM and RM are integrated with the business system as clients of Seata, and TC is deployed independently as the server of Seata.</p>
<p>TC is deployed independently as a Seata server. <a href="/assets/files/8-1e7e5bd472714f2a5eaf932b449942b2.png" target="_blank">image.png</a></p>
<p>The execution flow of a distributed transaction in Seata:</p>
<ul>
<li>TM opens distributed transaction (TM registers global transaction record with TC);</li>
<li>According to the business scenario, arrange the resources in the transaction such as database and service (RM reports the resource readiness status to TC);</li>
<li>TM ends the distributed transaction, and the transaction phase ends (TM notifies TC to commit/rollback the distributed transaction);</li>
<li>TC aggregates the transaction information and decides whether the distributed transaction should be committed or rolled back;</li>
<li>TC notifies all RMs to commit/rollback resources, transaction phase 2 ends;</li>
</ul>
<a name="1QKqI"></a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-distributed-transactions-seata-solution">3.3 Distributed Transactions Seata Solution<a href="#33-distributed-transactions-seata-solution" class="hash-link" aria-label="Direct link to 3.3 Distributed Transactions Seata Solution" title="Direct link to 3.3 Distributed Transactions Seata Solution">â</a></h3>
<p>Seata has four distributed transaction solutions, AT mode, TCC mode, Saga mode and XA mode.</p>
<p><img decoding="async" loading="lazy" alt="15_49_23__08_13_2019.jpg" src="/assets/images/9-92fbc62876258a48b6778d72eaab6af6.jpeg" width="746" height="385" class="img_ev3q"><br></p>
<a name="784n4"></a>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="231-at-mode">2.3.1 AT Mode<a href="#231-at-mode" class="hash-link" aria-label="Direct link to 2.3.1 AT Mode" title="Direct link to 2.3.1 AT Mode">â</a></h4>
<p>In January, Seata open sourced AT Mode, a non-intrusive distributed transaction solution. In AT mode, users only need to focus on their own &quot;business SQL&quot;, the user&#x27;s &quot;business SQL&quot; as a phase, Seata framework will automatically generate the transaction of the two-phase commit and rollback operations.</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="/assets/images/10-c19d842e385a2e54cc4b838e11642851.png" width="521" height="238" class="img_ev3q"><br></p>
<a name="Acfeo"></a>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="how-the-at-model-is-non-intrusive-to-business-">How the AT model is non-intrusive to business :<a href="#how-the-at-model-is-non-intrusive-to-business-" class="hash-link" aria-label="Direct link to How the AT model is non-intrusive to business :" title="Direct link to How the AT model is non-intrusive to business :">â</a></h5>
<ul>
<li>Phase I:</li>
</ul>
<p>In phase 1, Seata intercepts the &quot;business SQL&quot;, first parses the semantics of the SQL, finds the business data to be updated by the &quot;business SQL&quot;, and then saves it as a &quot;before image&quot; before updating the business data. Before the business data is updated, it will save it as &quot;before image&quot;, then execute &quot;business SQL&quot; to update the business data, and after the business data is updated, it will save it as &quot;after image&quot;, and finally generate row locks. The above operations are all done within a single database transaction, which ensures the atomicity of one phase of operation.</p>
<p>This ensures the atomicity of a phase of operations. <a href="/assets/files/11-b62ee2dfd6ab6e9094d2b51451b41cdd.png" target="_blank">image3.png</a></p>
<ul>
<li>Second-phase commit:</li>
</ul>
<p>If the second phase is a commit, since the &quot;business SQL&quot; has already been committed to the database in the first phase, the Seata framework only needs to delete the snapshot data and row locks saved in the first phase to complete the data cleanup.</p>
<p><img decoding="async" loading="lazy" alt="image 4.png" src="/assets/images/12-fb7571a44266fa4692599f2907e93125.png" width="480" height="206" class="img_ev3q"></p>
<ul>
<li>Phase 2 rollback:</li>
</ul>
<p>If the second phase is a rollback, Seata needs to rollback the &quot;business SQL&quot; that has been executed in the first phase to restore the business data. The way to rollback is to use &quot;before image&quot; to restore the business data; however, before restoring, we must first verify the dirty writing, compare the &quot;current business data in the database&quot; and the &quot;after image&quot;, if the two data are not in the same state, then we will use the &quot;after image&quot; to restore the business data. However, before restoring, we should first check the dirty writing, compare the &quot;current business data in database&quot; and &quot;after image&quot;, if the two data are completely consistent, it means there is no dirty writing, and we can restore the business data, if it is inconsistent, it means there is dirty writing, and we need to transfer the dirty writing to manual processing.</p>
<p><img decoding="async" loading="lazy" alt="image 5.png" src="/assets/images/13-67b42e8743563de3117194847e4119de.png" width="463" height="317" class="img_ev3q"></p>
<p>AT mode one phase, two phase commit and rollback are automatically generated by Seata framework, user only need to write &quot;business SQL&quot;, then can easily access distributed transaction, AT mode is a kind of distributed transaction solution without any intrusion to business.</p>
<a name="FnD1S"></a>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="232-tcc-mode">2.3.2 TCC Mode<a href="#232-tcc-mode" class="hash-link" aria-label="Direct link to 2.3.2 TCC Mode" title="Direct link to 2.3.2 TCC Mode">â</a></h4>
<p>In March 2019, Seata open-sourced the TCC pattern, which is contributed by Ant Gold. the TCC pattern requires users to implement Try, Confirm and Cancel operations according to their business scenarios; the transaction initiator executes the Try method in the first stage, the Confirm method in the second-stage commit, and the Cancel method in the second-stage rollback.</p>
<p>The transaction initiator performs Try in the first stage, Confirm in the second stage, and Cancel in the second stage. <a href="/assets/files/14-bd8bfbb4c59f42028ab03a8c409b1c73.png" target="_blank">image 6.png</a></p>
<p>TCC Three method descriptions:</p>
<ul>
<li>Try: detection and reservation of resources;</li>
<li>Confirm: the execution of the business operation submitted; require Try success Confirm must be successful;</li>
<li>Cancel: the release of the reserved resources;</li>
</ul>
<p><strong>Ant Gold&#x27;s practical experience in TCC</strong><br>**<br><img decoding="async" loading="lazy" alt="16_48_02__08_13_2019.jpg" src="/assets/images/15-02cfa1203b468d38c80caa594a7644f7.jpeg" width="746" height="414" class="img_ev3q"></p>
<p><strong>1 TCC Design - Business model is designed in 2 phases:</strong></p>
<p>The most important thing for users to consider when accessing TCC is how to split their business model into two phases.</p>
<p>Take the &quot;debit&quot; scenario as an example, before accessing TCC, the debit of account A can be completed with a single SQL for updating the account balance; however, after accessing TCC, the user needs to consider how to split the original one-step debit operation into two phases and implement it into three methods, and to ensure that the first-phase Try will be successful and the second-phase Confirm will be successful if Try is successful. If Try succeeds in the first stage, Confirm will definitely succeed in the second stage.</p>
<p><img decoding="async" loading="lazy" alt="image 7.png" src="/assets/images/16-e07ff8c531571c0ef2887d9dc8b4c83f.png" width="588" height="265" class="img_ev3q"></p>
<p>As shown above, the</p>
<p>Try method as a one-stage preparation method needs to do resource checking and reservation. In the deduction scenario, what Try has to do is to check whether the account balance is sufficient and reserve funds for transfer, and the way to reserve is to freeze the transfer funds of account A. After the execution of the Try method, although the balance of account A is still 100, but $30 of it has been frozen and cannot be used by other transactions.</p>
<p>The second stage, the Confirm method, performs the real debit operation; Confirm will use the funds frozen in the Try stage to perform the debit operation; after the Confirm method is executed, the $30 frozen in the first stage has been deducted from account A, and the balance of account A becomes $70.</p>
<p>If the second stage is a rollback, you need to release the $30 frozen in the first stage of Try in the Cancel method, so that account A is back to the initial state, and all $100 is available.</p>
<p>The most important thing for users to access TCC mode is to consider how to split the business model into 2 phases, implement it into 3 methods of TCC, and ensure that Try succeeds and Confirm succeeds. Compared to AT mode, TCC mode is somewhat intrusive to the business code, but TCC mode does not have the global line locks of AT mode, and the performance of TCC will be much higher than AT mode.</p>
<p><strong>2 TCC Design - Allow Null Rollback:</strong><br>**<br><img decoding="async" loading="lazy" alt="16_51_44__08_13_2019.jpg" src="/assets/images/17-b2c8866f3bee9d7eacf27c0e02f0ef68.jpeg" width="746" height="414" class="img_ev3q"></p>
<p>The Cancel interface needs to be designed to allow null rollbacks. When the Try interface is not received due to packet loss, the transaction manager triggers a rollback, which triggers the Cancel interface, which needs to return to the success of the rollback when it finds that there is no corresponding transaction xid or primary key during the execution of Cancel. If the transaction service manager thinks it has been rolled back, otherwise it will keep retrying, and Cancel has no corresponding business data to roll back.</p>
<p><strong>3 TCC Design - Anti-Suspension Control:</strong><br>**<br><img decoding="async" loading="lazy" alt="16_51_56__08_13_2019.jpg" src="/assets/images/18-3cfd6186d46d6c1cf79f4b5aea91aea0.jpeg" width="746" height="416" class="img_ev3q"></p>
<p>The implication of the suspension is that the Cancel is executed before the Try interface, which occurs because the Try times out due to network congestion, the transaction manager generates a rollback that triggers the Cancel interface, and the Try interface call is eventually received, but the Cancel arrives before the Try. According to the previous logic of allowing empty rollback, the rollback will return successfully, the transaction manager thinks the transaction has been rolled back successfully, then the Try interface should not be executed at this time, otherwise it will generate data inconsistency, so we record the transaction xid or business key before the Cancel empty rollback returns successfully, marking this record has been rolled back, the Try interface checks the transaction xid or business key first. The Try interface first checks the transaction xid or business key to identify that the record has been rolled back, and then does not perform the business operation of Try if it has already been marked as rolled back successfully.</p>
<p><strong>4 TCC Design - Power Control:</strong><br>**<br><img decoding="async" loading="lazy" alt="16_52_07__08_13_2019.jpg" src="/assets/images/19-cbc9396d9760ae9eee6ef163c21e8034.jpeg" width="746" height="415" class="img_ev3q"></p>
<p>Idempotence means that for the same system, using the same conditions, a single request and repeated multiple requests have the same impact on system resources. Because network jitter or congestion may timeout, transaction manager will retry operation on resources, so it is very likely that a business operation will be called repeatedly, in order not to occupy resources many times because of repeated calls, it is necessary to control idempotency when designing the service, usually we can use the transaction xid or the business primary key to judge the weight to control.</p>
<a name="dsMch"></a>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="233-saga-patterns">2.3.3 Saga Patterns<a href="#233-saga-patterns" class="hash-link" aria-label="Direct link to 2.3.3 Saga Patterns" title="Direct link to 2.3.3 Saga Patterns">â</a></h4>
<p>Saga mode is Seata&#x27;s upcoming open source solution for long transactions, which will be mainly contributed by Ant Gold. In Saga mode, there are multiple participants within a distributed transaction, and each participant is an offsetting compensation service that requires users to implement its forward and reverse rollback operations according to business scenarios.</p>
<p>During the execution of a distributed transaction, the forward operations of each participant are executed sequentially, and if all forward operations are executed successfully, the distributed transaction commits. If any of the forward operations fails, the distributed transaction will go back and execute the reverse rollback operations of the previous participants to roll back the committed participants and bring the distributed transaction back to the initial state.</p>
<p><img decoding="async" loading="lazy" alt="image 8.png" src="/assets/images/20-7a8ab27e616b4987792c11ff82ac900d.png" width="360" height="359" class="img_ev3q"></p>
<p>Saga Pattern Distributed transactions are usually event-driven and executed asynchronously between the various participants, Saga Pattern is a long transaction solution.</p>
<p><strong>1 Saga pattern usage scenario</strong><br>**<br><img decoding="async" loading="lazy" alt="16_44_58__08_13_2019.jpg" src="/assets/images/21-cb2c15b7cda9ba7e3870b03efb42b0f7.jpeg" width="746" height="416" class="img_ev3q"></p>
<p>Saga pattern is suitable for business systems with long business processes and the need to ensure the final consistency of transactions. Saga pattern commits local transactions at one stage, and performance can be guaranteed in the case of lock-free and long processes.</p>
<p>Transaction participants may be services from other companies or legacy systems that cannot be transformed and provide the interfaces required by TCC, and can use the Saga pattern.</p>
<p>The advantages of the Saga pattern are:</p>
<ul>
<li>One-stage commit of local database transactions, lock-free, high performance;</li>
<li>Participants can use transaction-driven asynchronous execution, high throughput;</li>
<li>The compensation service is the &quot;reverse&quot; of the forward service, which is easy to understand and implement;</li>
</ul>
<p>Disadvantages: The Saga pattern does not guarantee isolation because the local database transaction has already been committed in the first phase and no &quot;reservation&quot; action has been performed. Later we will talk about the lack of isolation of the countermeasures. <br><strong>2 Saga implementation based on a state machine engine</strong>* <br><strong>2 Saga implementation based on a state machine engine</strong>* <br>**3</p>
<p><img decoding="async" loading="lazy" alt="17_13_19__08_13_2019.jpg" src="/assets/images/22-d2bafd9570e63096283bb8cad41a0f43.png" width="1222" height="646" class="img_ev3q"></p>
<p>Currently there are generally two types of Saga implementations, one is achieved through event-driven architecture, and the other is based on annotations plus interceptors to intercept the business of the positive service implementation.Seata is currently implemented using an event-driven mechanism, Seata implements a state machine, which can orchestrate the call flow of the service and the compensation service of the positive service, generating a state diagram defined by a json file, and the state machine The state machine engine is driven to the operation of this map, when an exception occurs, the state machine triggers a rollback and executes the compensation services one by one. Of course, it is up to the user to decide when to trigger the rollback. The state machine can achieve the needs of service orchestration, it supports single selection, concurrency, asynchrony, sub-state machine call, parameter conversion, parameter mapping, service execution state judgement, exception catching and other functions.</p>
<p><strong>3 State Machine Engine Principles</strong><br></p>
<p><img decoding="async" loading="lazy" alt="16_45_32__08_13_2019.jpg" src="/assets/images/23-1d09ccedb0eb9f45ddda46963f6a9f12.png" width="1240" height="647" class="img_ev3q"></p>
<p>The basic principle of this state machine engine is that it is based on an event-driven architecture, where each step is executed asynchronously, and steps flow through an event queue between steps, <br>greatly improving system throughput. Transaction logs are recorded at the time of execution of each step for use when rolling back in the event of an exception. Transaction logs are recorded in the database where the business tables are located to improve performance.</p>
<p>**4 State Machine Engine Design</p>
<p><img decoding="async" loading="lazy" alt="16_45_46__08_13_2019.jpg" src="/assets/images/24-15fdd730a55833c61ceb860ada0f871b.jpeg" width="746" height="411" class="img_ev3q"></p>
<p>The state machine engine is divided into a three-tier architecture design, the bottom layer is the &quot;event-driven&quot; layer, the implementation of the EventBus and the consumption of events in the thread pool, is a Pub-Sub architecture. The second layer is the &quot;process controller&quot; layer, which implements a minimalist process engine framework that drives an &quot;empty&quot; process execution. node does, it just executes the process method of each node and then executes the route method to flow to the next node. This is a generic framework, based on these two layers, developers can implement any process engine. The top layer is the &quot;state machine engine&quot; layer, which implements the &quot;behaviour&quot; and &quot;route&quot; logic code of each state node, provides APIs and statechart repositories, and has some other components, such as expression languages, logic languages, and so on. There are also a number of other components, such as expression languages, logic calculators, flow generators, interceptors, configuration management, transaction logging, and so on.</p>
<p><strong>5 The Saga Service Design Experience</strong></p>
<p>Similar to TCC, Saga&#x27;s forward and reverse services need to follow the following design principles:</p>
<p><strong>1) Saga Service Design - Allow Null Compensation</strong><br>**<br><img decoding="async" loading="lazy" alt="16_52_22__08_13_2019.jpg" src="/assets/images/25-2cae6395619166a3c23e698ac2306f8b.jpeg" width="746" height="415" class="img_ev3q"></p>
<p><strong>2) Saga Service Design - Anti-Suspension Control</strong><br>**<br><img decoding="async" loading="lazy" alt="16_52_52__08_13_2019.jpg" src="/assets/images/26-ead26d36857d8ae91dbb16ff72873653.jpeg" width="746" height="417" class="img_ev3q"></p>
<p><strong>3) Saga Service Design - Power Control</strong><br>**<br><img decoding="async" loading="lazy" alt="3 Distributed Transactions Seata Three Patterns Explained - Yi Yuan-31.jpg" src="/assets/images/27-11883ffbfbca7e56a3a5984f3e0c3fe6.jpeg" width="746" height="420" class="img_ev3q"></p>
<p><strong>4) Saga Design - Custom Transaction Recovery Strategies</strong><br>**<br><img decoding="async" loading="lazy" alt="16_53_07__08_13_2019.jpg" src="/assets/images/28-73c6b9cfb082be166cb84a9381b81c0f.jpeg" width="746" height="414" class="img_ev3q"></p>
<p>As mentioned earlier, the Saga pattern does not guarantee transaction isolation, and dirty writes can occur in extreme cases. For example, in the case of a distributed transaction is not committed, the data of the previous service was modified, and the service behind the anomaly needs to be rolled back, may not be able to compensate for the operation due to the data of the previous service was modified. One way to deal with this situation is to &quot;retry&quot; and continue forward to complete the distributed transaction. Since the entire business process is arranged by the state machine, even after the recovery can continue to retry. So you can configure the transaction policy of the process according to the business characteristics, whether to give priority to &quot;rollback&quot; or &quot;retry&quot;, when the transaction timeout, the Server side will continue to retry according to this policy.</p>
<p>Since Saga does not guarantee isolation, we need to achieve the principle of &quot;long money rather than short money&quot; in business design. Long money refers to the situation when there is a mistake and the money is too much from our point of view, and the money is too little, because if the money is too long, we can refund the money to the customer, but if it is too short, the money may not be recovered, which means that in the business design, we must give priority to &quot;rollback&quot; or &quot;retry&quot;. That is, when the business is designed, it must be deducted from the customer&#x27;s account before crediting the account, and if the override update is caused by the isolation problem, there will not be a case of less money.</p>
<p><strong>6 Annotation and Interceptor Based Saga Implementation</strong><br>**<br><img decoding="async" loading="lazy" alt="17_13_37__08_13_2019.jpg" src="/assets/images/29-3d3a00510ed54a37763e1558f7343789.jpeg" width="746" height="416" class="img_ev3q"></p>
<p>There is another implementation of Saga that is based on annotations + interceptors, which Seata does not currently implement. You can look at the pseudo-code above to understand it, the @SagaCompensable annotation is defined on the one method, and the compensation method used to define the one method is the compensateOne method. Then the @SagaTransactional annotation is defined on the processA method of the business process code, which starts a Saga distributed transaction, intercepts each forward method with an interceptor, and triggers a rollback operation when an exception occurs, calling the compensation method of the forward method.</p>
<p>**7 Comparison of Advantages and Disadvantages of the Two Saga Implementations</p>
<p>The following table compares the advantages and disadvantages of the two Saga implementations:</p>
<p><img decoding="async" loading="lazy" alt="17_13_49__08_13_2019.jpg" src="/assets/images/30-990cbb972417453d06119316c2c1bc7e.jpeg" width="746" height="415" class="img_ev3q"></p>
<p>The biggest advantage of the state machine engine is that it can be executed asynchronously through an event-driven approach to improve system throughput, service scheduling requirements can be achieved, and in the absence of isolation in the Saga model, there can be an additional &quot;retry forward&quot; strategy to recover from things. The biggest advantage of annotations and interceptors is that they are easy to develop and low cost to learn.</p>
<a name="Gpkrf"></a>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">â</a></h2>
<p>This article first reviewed the background and theoretical basis of distributed transactions, and then focused on the principles of Seata distributed transactions and three patterns (AT, TCC, Saga) of distributed transaction implementation.</p>
<p>Seata&#x27;s positioning is a full-scenario solution for distributed transactions, and in the future there will also be XA mode of distributed transaction implementation, each mode has its own application scenarios, AT mode is a non-intrusive distributed transaction solution for scenes that do not want to transform the business, with almost zero learning cost. TCC mode is a high-performance distributed transaction solution for core systems and other scenes that have a high demand for performance. Saga mode is a long transaction solution for business systems that have long business processes and need to ensure the ultimate consistency of transactions. Saga mode submits local transactions at one stage, with no locks, and can ensure performance in the case of long processes, and is mostly used in the channel layer and integration layer of business systems. Transaction participants may be services from other companies or legacy systems that can&#x27;t be transformed to provide the interfaces required by TCC, Saga mode can also be used.</p>
<p>The video review and PPT of this sharing can be viewed at: [<a href="https://tech.antfin.com/community/activities/779/review%5D(" target="_blank" rel="noopener noreferrer">https://tech.antfin.com/community/activities/779/review](</a><a href="https://tech.antfin.com/community/activities/779/" target="_blank" rel="noopener noreferrer">https://tech.antfin.com/community/activities/779/</a> review)</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col margin-top--sm"><a href="https://github.com/apache/incubator-seata-website/blob/docusaurus/i18n/en/docusaurus-plugin-content-blog/seata-at-tcc-saga.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/design-more-flexable-application-by-saga"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Designing More Flexible Financial Applications with Seata Saga</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/seata-at-mode-design"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Design Principles of Distributed Transaction Middleware Seata</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#i-background-of-the-emergence-of-distributed-transactions" class="table-of-contents__link toc-highlight">I. Background of the emergence of distributed transactions</a><ul><li><a href="#11-distributed-architecture-evolution---horizontal-splitting-of-database" class="table-of-contents__link toc-highlight">1.1 Distributed Architecture Evolution - Horizontal Splitting of Database</a></li><li><a href="#12-distributed-architecture-evolution---business-service-splitting" class="table-of-contents__link toc-highlight">1.2 Distributed Architecture Evolution - Business Service Splitting</a></li></ul></li><li><a href="#ii-theoretical-foundation-of-distributed-transaction" class="table-of-contents__link toc-highlight">II. Theoretical foundation of distributed transaction</a><ul><li><a href="#21-two-stage-commit-protocols" class="table-of-contents__link toc-highlight">2.1 Two-stage commit protocols</a></li><li><a href="#22-tcc" class="table-of-contents__link toc-highlight">2.2 TCC</a></li><li><a href="#23-saga" class="table-of-contents__link toc-highlight">2.3 Saga</a></li></ul></li><li><a href="#iii-seata-and-its-three-patterns-explained-in-detail" class="table-of-contents__link toc-highlight">III. Seata and its three patterns explained in detail</a><ul><li><a href="#31-distributed-transaction-seata-introduction" class="table-of-contents__link toc-highlight">3.1 Distributed transaction Seata introduction</a></li><li><a href="#32-distributed-transactions-seata-product-module" class="table-of-contents__link toc-highlight">3.2 Distributed Transactions Seata Product Module</a></li><li><a href="#33-distributed-transactions-seata-solution" class="table-of-contents__link toc-highlight">3.3 Distributed Transactions Seata Solution</a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/apache/incubator.svg" alt="Apache Incubator Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/apache/incubator.svg" alt="Apache Incubator Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="footer__copyright">
                  <div class="fs-12">
                    <div class="center-div">
                      <span>Apache Seata (incubating) is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</span>
                    </div>
                    <br>
                    <div class="center-div">
                      <span>Copyright Â© 2023-2024, The Apache Software Foundation Apache Seata, Seata, Apache, Apache Incubator, the Apache feather, the Apache Incubator logo and the Apache Seata project logo are either registered trademarks or trademarks of the Apache Software Foundation.</span>
                      <br>
                    </div>
                    <br>
                  </div>
                  </div></div></div></footer></div>
</body>
</html>